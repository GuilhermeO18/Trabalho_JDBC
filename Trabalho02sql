--EXCLUI TODAS AS TABELAS
DROP TABLE VENDA_PRODUTO;

DROP TABLE VENDA_PAGTO;

DROP TABLE VENDA;

DROP TABLE COMPRA_PRODUTO;

DROP TABLE COMPRA;

DROP TABLE FORNECEDOR;

DROP TABLE CLIENTE;

DROP TABLE FORMAPAGTO;

DROP TABLE PESSOA;

DROP TABLE USUARIO;

DROP TABLE PRODUTO;

--CRIA AS TABELAS
CREATE TABLE PESSOA (
    PES_CODIGO        INTEGER NOT NULL,
    PES_NOME          VARCHAR2(80) NOT NULL,
    PES_FANTASIA      VARCHAR2(80),
    PES_FISICA        CHAR(1) NOT NULL,
    PES_CPFCNPJ       VARCHAR2(20) NOT NULL,
    PES_RGIE          VARCHAR2(20),
    PES_CADASTRO      DATE,
    PES_ENDERECO      VARCHAR2(120),
    PES_NUMERO        VARCHAR2(10),
    PES_COMPLEMENTO   VARCHAR2(30),
    PES_BAIRRO        VARCHAR2(50),
    PES_CIDADE        VARCHAR2(80),
    PES_UF            CHAR(2),
    PES_CEP           VARCHAR2(9),
    PES_FONE1         VARCHAR2(16),
    PES_FONE2         VARCHAR2(16),
    PES_CELULAR       VARCHAR2(16),
    PES_SITE          VARCHAR2(200),
    PES_EMAIL         VARCHAR2(200),
    PES_ATIVO         CHAR(1)
);

CREATE TABLE CLIENTE (
    CLI_CODIGO       INTEGER NOT NULL,
    PES_CODIGO       INTEGER NOT NULL,
    CLI_LIMITECRED   NUMBER(18, 2)
);

CREATE TABLE FORNECEDOR (
    FOR_CODIGO    INTEGER NOT NULL,
    PES_CODIGO    INTEGER NOT NULL,
    FOR_CONTATO   VARCHAR2(80)
);

CREATE TABLE USUARIO (
    USU_CODIGO     INTEGER NOT NULL,
    USU_NOME       VARCHAR2(80),
    USU_LOGIN      VARCHAR2(20) NOT NULL,
    USU_SENHA      VARCHAR2(20),
    USU_CADASTRO   DATE,
    USU_ATIVO      CHAR(1)
);

CREATE TABLE VENDA (
    VDA_CODIGO     INTEGER NOT NULL,
    USU_CODIGO     INTEGER NOT NULL,
    CLI_CODIGO     INTEGER NOT NULL,
    VDA_DATA       DATE NOT NULL,
    VDA_VALOR      NUMBER(18, 2),
    VDA_DESCONTO   NUMBER(18, 2),
    VDA_TOTAL      NUMBER(18, 2),
    VDA_OBS        CLOB
);

CREATE TABLE COMPRA (
    CPR_CODIGO     INTEGER NOT NULL,
    USU_CODIGO     INTEGER NOT NULL,
    FOR_CODIGO     INTEGER NOT NULL,
    CPR_EMISSAO    DATE,
    CPR_VALOR      NUMBER(18, 2),
    CPR_DESCONTO   NUMBER(18, 2),
    CPR_TOTAL      NUMBER(18, 2),
    CPR_DENTRADA   DATE,
    CPR_OBS        CLOB
);

CREATE TABLE PRODUTO (
    PRO_CODIGO      INTEGER NOT NULL,
    PRO_NOME        VARCHAR2(80) NOT NULL,
    PRO_ESTOQUE     NUMBER(14, 4),
    PRO_UNIDADE     VARCHAR2(5),
    PRO_PRECO       NUMBER(18, 2),
    PRO_CUSTO       NUMBER(18, 2),
    PRO_ATACADO     NUMBER(18, 2),
    PRO_MIN         NUMBER(14, 4),
    PRO_MAX         NUMBER(14, 4),
    PRO_EMBALAGEM   DECIMAL(9, 0),
    PRO_PESO        NUMBER(14, 4),
    PRO_CADASTRO    DATE,
    PRO_OBS         CLOB,
    PRO_ATIVO       CHAR(1)
);

CREATE TABLE VENDA_PRODUTO (
    VEP_CODIGO     INTEGER NOT NULL,
    VDA_CODIGO     INTEGER NOT NULL,
    PRO_CODIGO     INTEGER NOT NULL,
    VEP_QTDE       NUMBER(14, 4),
    VEP_PRECO      NUMBER(18, 2),
    VEP_DESCONTO   NUMBER(18, 2),
    VEP_TOTAL      NUMBER(18, 2)
);

CREATE TABLE VENDA_PAGTO (
    VDP_CODIGO   INTEGER NOT NULL,
    VDA_CODIGO   INTEGER NOT NULL,
    FPG_CODIGO   INTEGER NOT NULL,
    VDP_VALOR    NUMBER(18, 2)
);

CREATE TABLE FORMAPAGTO (
    FPG_CODIGO   INTEGER NOT NULL,
    FPG_NOME     VARCHAR2(80) NOT NULL,
    FPG_ATIVO    CHAR(1)
);

CREATE TABLE COMPRA_PRODUTO (
    CPP_CODIGO     INTEGER NOT NULL,
    CPR_CODIGO     INTEGER NOT NULL,
    PRO_CODIGO     INTEGER NOT NULL,
    CPR_QTDE       NUMBER(14, 4) NOT NULL,
    CPR_PRECO      NUMBER(18, 2) NOT NULL,
    CPR_DESCONTO   NUMBER(18, 2),
    CPR_TOTAL      NUMBER(18, 2)
);

--INSERE AS PRIMARY KEYS
ALTER TABLE PESSOA ADD CONSTRAINT PK_PESSOA PRIMARY KEY ( PES_CODIGO );

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY ( CLI_CODIGO );

ALTER TABLE FORNECEDOR ADD CONSTRAINT PK_FORNECEDOR PRIMARY KEY ( FOR_CODIGO );

ALTER TABLE USUARIO ADD CONSTRAINT PK_USUARIO PRIMARY KEY ( USU_CODIGO );

ALTER TABLE VENDA ADD CONSTRAINT PK_VENDA PRIMARY KEY ( VDA_CODIGO );

ALTER TABLE COMPRA ADD CONSTRAINT PK_COMPRA PRIMARY KEY ( CPR_CODIGO );

ALTER TABLE PRODUTO ADD CONSTRAINT PK_PRODUTO PRIMARY KEY ( PRO_CODIGO );

ALTER TABLE VENDA_PRODUTO ADD CONSTRAINT PK_VENDA_PRODUTO PRIMARY KEY ( VEP_CODIGO );

ALTER TABLE VENDA_PAGTO ADD CONSTRAINT PK_VENDA_PAGTO PRIMARY KEY ( VDP_CODIGO );

ALTER TABLE FORMAPAGTO ADD CONSTRAINT PK_FORMAPAGTO PRIMARY KEY ( FPG_CODIGO );

ALTER TABLE COMPRA_PRODUTO ADD CONSTRAINT PK_COMPRA_PRODUTO PRIMARY KEY ( CPP_CODIGO );

--INSERE AS FOREIGN KEYS
ALTER TABLE CLIENTE
    ADD CONSTRAINT FK_CLIENTE_PESSOA FOREIGN KEY ( PES_CODIGO )
        REFERENCES PESSOA ( PES_CODIGO );

ALTER TABLE FORNECEDOR
    ADD CONSTRAINT FK_FORNECEDOR_PESSOA FOREIGN KEY ( PES_CODIGO )
        REFERENCES PESSOA ( PES_CODIGO );

ALTER TABLE VENDA
    ADD CONSTRAINT FK_VENDA_CLIENTE FOREIGN KEY ( CLI_CODIGO )
        REFERENCES CLIENTE ( CLI_CODIGO );

ALTER TABLE VENDA
    ADD CONSTRAINT FK_VENDA_USUARIO FOREIGN KEY ( USU_CODIGO )
        REFERENCES USUARIO ( USU_CODIGO );

ALTER TABLE COMPRA
    ADD CONSTRAINT FK_COMPRA_CLIENTE FOREIGN KEY ( FOR_CODIGO )
        REFERENCES FORNECEDOR ( FOR_CODIGO );

ALTER TABLE COMPRA
    ADD CONSTRAINT FK_COMPRA_USUARIO FOREIGN KEY ( USU_CODIGO )
        REFERENCES USUARIO ( USU_CODIGO );

ALTER TABLE VENDA_PRODUTO
    ADD CONSTRAINT FK_VENDA_PRODUTO_VENDA FOREIGN KEY ( VDA_CODIGO )
        REFERENCES VENDA ( VDA_CODIGO );

ALTER TABLE VENDA_PRODUTO
    ADD CONSTRAINT FK_VENDA_PRODUTO_PRODUTO FOREIGN KEY ( PRO_CODIGO )
        REFERENCES PRODUTO ( PRO_CODIGO );

ALTER TABLE VENDA_PAGTO
    ADD CONSTRAINT FK_VENDA_PAGTO_VENDA FOREIGN KEY ( VDA_CODIGO )
        REFERENCES VENDA ( VDA_CODIGO );

ALTER TABLE VENDA_PAGTO
    ADD CONSTRAINT FK_VENDA_PAGTO_FORMAPAGTO FOREIGN KEY ( FPG_CODIGO )
        REFERENCES FORMAPAGTO ( FPG_CODIGO );

ALTER TABLE COMPRA_PRODUTO
    ADD CONSTRAINT FK_COMPRA_PRODUTO_COMPRA FOREIGN KEY ( CPR_CODIGO )
        REFERENCES COMPRA ( CPR_CODIGO );

ALTER TABLE COMPRA_PRODUTO
    ADD CONSTRAINT FK_COMPRA_PRODUTO_PRODUTO FOREIGN KEY ( PRO_CODIGO )
        REFERENCES PRODUTO ( PRO_CODIGO );

--CRIA AS SEQUENCES E TRIGGERS
DROP SEQUENCE SEQ_PESSOA;

CREATE SEQUENCE SEQ_PESSOA NOCACHE;

CREATE OR REPLACE TRIGGER TRG_PESSOA BEFORE
    INSERT ON PESSOA
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_PESSOA.NEXTVAL
    INTO :NEW.PES_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_CLIENTE;

CREATE SEQUENCE SEQ_CLIENTE NOCACHE;

CREATE OR REPLACE TRIGGER TRG_CLIENTE BEFORE
    INSERT ON CLIENTE
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_CLIENTE.NEXTVAL
    INTO :NEW.CLI_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_FORNECEDOR;

CREATE SEQUENCE SEQ_FORNECEDOR NOCACHE;

CREATE OR REPLACE TRIGGER TRG_FORNECEDOR BEFORE
    INSERT ON FORNECEDOR
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_FORNECEDOR.NEXTVAL
    INTO :NEW.FOR_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_USUARIO;

CREATE SEQUENCE SEQ_USUARIO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_USUARIO BEFORE
    INSERT ON USUARIO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_USUARIO.NEXTVAL
    INTO :NEW.USU_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_VENDA;

CREATE SEQUENCE SEQ_VENDA NOCACHE;

CREATE OR REPLACE TRIGGER TRG_VENDA BEFORE
    INSERT ON VENDA
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_VENDA.NEXTVAL
    INTO :NEW.VDA_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_COMPRA;

CREATE SEQUENCE SEQ_COMPRA NOCACHE;

CREATE OR REPLACE TRIGGER TRG_COMPRA BEFORE
    INSERT ON COMPRA
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_COMPRA.NEXTVAL
    INTO :NEW.CPR_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_PRODUTO;

CREATE SEQUENCE SEQ_PRODUTO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_PRODUTO BEFORE
    INSERT ON PRODUTO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_PRODUTO.NEXTVAL
    INTO :NEW.PRO_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_VENDA_PRODUTO;

CREATE SEQUENCE SEQ_VENDA_PRODUTO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_VENDA_PRODUTO BEFORE
    INSERT ON VENDA_PRODUTO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_VENDA_PRODUTO.NEXTVAL
    INTO :NEW.VEP_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_COMPRA_PRODUTO;

CREATE SEQUENCE SEQ_COMPRA_PRODUTO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_COMPRA_PRODUTO BEFORE
    INSERT ON COMPRA_PRODUTO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_COMPRA_PRODUTO.NEXTVAL
    INTO :NEW.CPP_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_FORMAPAGTO;

CREATE SEQUENCE SEQ_FORMAPAGTO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_FORMAPAGTO BEFORE
    INSERT ON FORMAPAGTO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_FORMAPAGTO.NEXTVAL
    INTO :NEW.FPG_CODIGO
    FROM
        DUAL;

END;
/

DROP SEQUENCE SEQ_VENDA_PAGTO;

CREATE SEQUENCE SEQ_VENDA_PAGTO NOCACHE;

CREATE OR REPLACE TRIGGER TRG_VENDA_PAGTO BEFORE
    INSERT ON VENDA_PAGTO
    FOR EACH ROW
BEGIN
    SELECT
        SEQ_VENDA_PAGTO.NEXTVAL
    INTO :NEW.VDP_CODIGO
    FROM
        DUAL;

END;
/